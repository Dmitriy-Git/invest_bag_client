<div class="chat-panel">
  <!-- Header -->
  <div class="chat-panel__header">
    <div class="chat-panel__title">
      <mat-icon>smart_toy</mat-icon>
      <span>AI-помощник</span>
    </div>
    <div class="chat-panel__status">
      @if (chatService.isConnected()) {
        <span class="status-dot status-dot--online"></span>
      } @else {
        <span class="status-dot status-dot--offline"></span>
      }
    </div>
    <button mat-icon-button (click)="close.emit()" aria-label="Закрыть">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Messages -->
  <div class="chat-panel__messages" #messagesContainer>
    @for (msg of chatService.messages(); track msg.id) {
      <div class="message" [class.message--user]="msg.role === 'user'"
           [class.message--assistant]="msg.role === 'assistant'">
        <div class="message__content">
          {{ msg.content }}
          @if (msg.isStreaming) {
            <span class="typing-cursor">|</span>
          }
        </div>
      </div>
    } @empty {
      <div class="chat-panel__empty">
        <mat-icon>chat_bubble_outline</mat-icon>
        <p>Начните диалог с AI-помощником</p>
      </div>
    }
  </div>

  <!-- Input -->
  <div class="chat-panel__input">
    <input
      type="text"
      placeholder="Введите сообщение..."
      [value]="inputValue()"
      (input)="inputValue.set($any($event.target).value)"
      (keydown)="onKeydown($event)"
      [disabled]="!chatService.isConnected()"
    />
    <button
      mat-icon-button
      color="primary"
      (click)="sendMessage()"
      [disabled]="!inputValue().trim() || chatService.isLoading() || !chatService.isConnected()"
      aria-label="Отправить"
    >
      @if (chatService.isLoading()) {
        <mat-spinner diameter="24"></mat-spinner>
      } @else {
        <mat-icon>send</mat-icon>
      }
    </button>
  </div>
</div>
